<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/common.css">
		<link rel="stylesheet" href="css/user.css">

		
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="record" class="mui-pull-left text-header">记录</a>
			<h1 id="title" class="mui-title">个人中心</h1>
			<!--<a id="share" class="mui-pull-right text-header">分享</a>-->
		</header>
		<nav class="mui-bar mui-bar-tab">
			<a class="home-tab-item mui-active" id="index_main">
				<span class="mui-icon iconfont icon-pengyou"></span>
				<span class="mui-tab-label">互助</span>
			</a>
			<a class="home-tab-item" id="index_expanded">
				<span class="mui-icon iconfont icon-tuiguang"></span>
				<span class="mui-tab-label">推广</span>
			</a>
			<a class="home-tab-item" id="index_shop">
				<span class="mui-icon iconfont icon-shangcheng"></span>
				<span class="mui-tab-label">商城</span>
			</a>
			<a class="home-tab-item" id="index_user">
				<span class="mui-icon iconfont icon-gerenzhongxin"></span>
				<span class="mui-tab-label">个人</span>
			</a>
		</nav>
		<div class="mui-content">
			<div class="expand-user">
				<div class="user-name">
					<p class="username">
						<span id="username"></span>
						<button type="button" class="no" id="group"></button>
					</p>
					<p id="jointime"></p>
					<p id="telephone"></p>
					<p id="parent"></p>
				</div>
			</div>
			<table class="mui-table-view optionTable" cellpadding="0" cellspacing="0" border="0" width="99.99%">
				<tr>
					<td class="mui-table-cell" width="50%" id="changePassword">
						<span class="iconfont icon-zhanghao" style="color:#bd1540; font-size: 30px; margin-right:5px; vertical-align: middle;"></span>
						修改密码
					</td>
					<td class="mui-table-cell" width="50%" id="setBank">
						<span class="iconfont icon-yinxingqia" style="color:#2b7531; font-size: 20px; margin-right:5px; vertical-align: middle;"></span>
						收款方式
					</td>
				</tr>
				<tr>
					<td class="mui-table-cell" width="50%" id="questions">
						<span class="iconfont icon-q-a" style="color:#4899cd; font-size: 30px; margin-right:5px; vertical-align: middle;"></span>
						常见问题
					</td>
					<td class="mui-table-cell" width="50%" id="cashDetail">
						<span class="iconfont icon-suodeshui" style="color:#eb8523; font-size: 30px; margin-right:5px; vertical-align: middle;"></span>
						奖金明细
					</td>
				</tr>
			</table>
			<table class="mui-table-view optionTable" cellpadding="0" cellspacing="0" border="0" width="99.99%">
				<tr>
					<td class="mui-table-cell" width="50%" id="guestbook">
						<span class="iconfont icon-liuyan" style="color:#35753c; font-size: 30px; margin-right:5px; vertical-align: middle;"></span>
						系统留言
					</td>
					<td class="mui-table-cell" width="50%" id="systemNote">
						<span class="iconfont icon-tongzhi" style="color:#d6281d; font-size: 30px; margin-right:5px; vertical-align: middle;"></span>
						系统通知
					</td>
				</tr>
			</table>
		</div>
		<div class="mui-content-padded">
			<button id='exit' class="mui-btn mui-btn-block mui-btn-primary">退出</button>
		</div>
	</body>
	<script src="js/mui.min.js"></script>
	<script src="js/app.js"></script>
	<script src="script/user.js"></script>
	<script>
	(function($, doc) {
		$.init({
			swipeBack:true //启用右滑关闭功能
		});
		var username = doc.getElementById("username");
		var jointime = doc.getElementById("jointime");
		var group = doc.getElementById("group");
		var telephone = doc.getElementById("telephone");
		var parent = doc.getElementById("parent");
		
		// 功能菜单
		var dealRecord = doc.getElementById("record");
		
		var changePassword = doc.getElementById("changePassword");
		var setBank = doc.getElementById("setBank");
		var questions = doc.getElementById("questions");
		var cashDetail = doc.getElementById("cashDetail");
		var guestbook = doc.getElementById("guestbook");
		var systemNote = doc.getElementById("systemNote");
		
		$.plusReady(function() {
			var state = app.getState();
			
			window.addEventListener("refreshData", function(e) {
				var newState = app.getState();
				username.innerHTML = newState.truename;
				group.innerHTML = '<i class="iconfont icon-xunzhang"></i>'+newState.group;
			});
			
			username.innerHTML = state.truename;
			telephone.innerHTML = "手机号码："+state.username;
			jointime.innerHTML = "加入时间："+state.jointime;
			parent.innerHTML = "推荐号码："+state.parent;
			group.innerHTML = '<i class="iconfont icon-xunzhang"></i>'+state.group;
			
			var dealRecordPage = $.preload({
				"id"  : "dealRecord",
				"url" : "deal_record.html"
			});
			dealRecord.addEventListener("tap", function(){
				$.openWindow({
					id: 'dealRecord',
					show: {
						aniShow: 'pop-in'
					},
					waiting: {
						autoShow: false
					}
				});
			}, false);
			
			var changePasswordPage = $.preload({
				"id"  : "changePassword",
				"url" : "change_password.html"
			});
			changePassword.addEventListener("tap", function(){
				$.openWindow({
					id: 'changePassword',
					show: {
						aniShow: 'pop-in'
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			var setBankPage = $.preload({
				"id"  : "setBank",
				"url" : "set_bank.html"
			});
			setBank.addEventListener("tap", function(){
				$.openWindow({
					id: 'setBank',
					show: {
						aniShow: 'pop-in'
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			var questionPage = $.preload({
				"id"  : "question",
				"url" : "question.html"
			});
			questions.addEventListener("tap", function(){
				$.openWindow({
					id: 'question',
					show: {
						aniShow: 'pop-in'
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			guestbook.addEventListener("tap", function(){
				$.openWindow({
					id: 'feedback',
					url: 'feedback.html',
					show: {
						aniShow: 'pop-in'
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			systemNote.addEventListener("tap", function(){
				$.openWindow({
					id: 'announce',
					url : "announce.html",
					show: {
						aniShow: 'pop-in'
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			cashDetail.addEventListener("tap", function(){
				$.openWindow({
					id: 'wallet',
					url: "wallet.html",
					show: {
						aniShow: 'pop-in'
					},
					createNew: true,
					waiting: {
						autoShow: false
					}
				});
			});
			
			
		});
	}(mui, document));
	
	document.getElementById('exit').addEventListener('tap', function() {
		if (mui.os.ios) {
			app.setState({});
			plus.runtime.restart();
			mui.openWindow({
				url: 'login.html',
				id: 'login',
				show: {
					aniShow: 'pop-in'
				},
				waiting: {
					autoShow: false
				}
			});
			return;
		}
		var btnArray = [{ title: "注销当前账号" }, { title: "直接关闭应用" }];
		plus.nativeUI.actionSheet({
			cancel: "取消",
			buttons: btnArray
		}, function(event) {
			var index = event.index;
			switch (index) {
				case 1:
					app.setState({});
					plus.runtime.restart();
					mui.openWindow({
						url: 'index.html',
						id: 'index',
						show: {
							aniShow: 'pop-in'
						},
						waiting: {
							autoShow: false
						}
					});
					break;
				case 2:
					plus.runtime.quit();
					break;
			}
		});
	}, false);
	    mui.plusReady(function() {

            var supgrade = document.getElementById("supgrade");

              
        });
        
//	var shares = {};
//	mui.plusReady(function() {
//		plus.share.getServices(function(s) {
//			if (s && s.length > 0) {
//				for (var i = 0; i < s.length; i++) {
//					var t = s[i];
//					shares[t.id] = t;
//				}
//			}
//		}, function() {
//			console.log("获取分享服务列表失败");
//		});
//	});
	 //分享链接点击事件
//	document.getElementById("share").addEventListener('tap', function() {
//		var ids = [{
//				id: "weixin",
//				ex: "WXSceneSession"
//			}, {
//				id: "weixin",
//				ex: "WXSceneTimeline"
//			}, {
//				id: "sinaweibo"
//			}, {
//				id: "tencentweibo"
//			}, {
//				id: "qq"
//			}],
//			bts = [{
//				title: "发送给微信好友"
//			}, {
//				title: "分享到微信朋友圈"
//			}, {
//				title: "分享到新浪微博"
//			}, {
//				title: "分享到腾讯微博"
//			}, {
//				title: "分享到QQ"
//			}];
//		plus.nativeUI.actionSheet({
//			cancel: "取消",
//			buttons: bts
//		}, function(e) {
//			var i = e.index;
//			if (i > 0) {
//				var s_id = ids[i - 1].id;
//				var share = shares[s_id];
//				if (share.authenticated) {
//					shareMessage(share, ids[i - 1].ex);
//				} else {
//					share.authorize(function() {
//						shareMessage(share, ids[i - 1].ex);
//					}, function(e) {
//						console.log("认证授权失败：" + e.code + " - " + e.message);
//					});
//				}
//			}
//		});
//	});

	function shareMessage(share, ex) {
		var msg = {
			extra: {
				scene: ex
			}
		};
		msg.href = "http://www.jkbbt.com/";
		msg.title = "拉拉互助平台";
		msg.content = "拉拉互助平台，让我们帮助我们！让我们一起改变世界！";
		if (~share.id.indexOf('weibo')) {
			msg.content += "；APP下载：www.jkbbt.com";
		}
		msg.thumbs = ["images/logo.png"];
		share.send(msg, function() {
			console.log("分享到\"" + share.description + "\"成功！ ");
		}, function(e) {
			console.log("分享到\"" + share.description + "\"失败: " + e.code + " - " + e.message);
		});
	}
	</script>

</script>
</html>